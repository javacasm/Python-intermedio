## Librería Tkinter

### App sencilla

Vamos a crear una aplicación que nos permita obtener el tiempo actual o el pronóstico de cualquier localidad para lo que usaremos el código que ya hicimos. La aplicación nos permitirá seleccionar entre el tiempo actual o el pronóstico. También tendremos que facilitar la localización que queremos utilizar. 

![](./images/tka-agenda.png)

* Importamos todos los elementos de la librería **Tk** 

```python
from tkinter import *
```

* Creamos la ventana base y definimos su geometría: ancho x alto + x + y, definiendo unas variables para el tamaño que usaremos a lo largo del programa

```python
base_window = Tk()
ancho_ventana = 350
alto_ventana = 400
base_window.geometry(f'{ancho_ventana}x{alto_ventana}+1200+200')
```

* Asignamos un título a la ventana

```python
base_window.title('Weather forecast')  # asignamos un título
```

* Establecemos el comportamiento de la ventana para que no se pueda modificar sus dimensiones

```python
base_window.resizable(height=False,width=False)  # definimos su comportamiento ante cambios de tamaño
```

* Definimos los colores que vamos a usar, utilizando el formato RGB de 6 cifras hexadecimales, 2 para cada color. Podemos seleccionar los colores desde [esta página](https://www.w3schools.com/colors/colors_picker.asp)

```python
# Colores 
# Selección con https://www.w3schools.com/colors/colors_picker.asp
color_blanco = '#FFFFFF'
color_negro = '#000000'
color_titulo = '#081F4D'
color_boton = '#0083FF'
```

* Para colocar los controles utilizaremos **frames** (marcos) que nos permiten organizar los controles dentro de la ventana y asignarles colores y aspectos distintos. El __frame__ superior tendrá un color diferente y contendrá el título. Vemos como al crearlo le pasamos como argumento la ventana de la que colgará y definimos su color de fondo, su ancho y alto. También le asignamos una fila y columna para "colocarlo" dentro de la ventana base.

```python
top_frame_titulo = Frame(base_window,
                         bg = color_titulo,
                         width = ancho_ventana,
                         height = 80)

top_frame_titulo.grid(row=0,column=0) #
```

* Ahora colocamos un control de tipo label (etiqueta) que actuará como "título" de nuestra aplicación y al que le daremos un color de fondo y un tipo de letra. No hay que confundir esta etiqueta con el título de la ventana que asignamos antes:

```python
label_titulo = Label(top_frame_titulo,
                      text = 'Prevision del tiempo',
                      bg = color_titulo,
                      fg = color_blanco,
                      pady = 30, padx = 10,
                      justify = CENTER,
                      font = ('Poppins 18 bold'))
 
label_titulo.grid(row=0,column=0) 
```

* Ahora vamos a definir un Frame para la parte de abajo donde pondremos los controles y le damos la posición de la fila segunda. 

```python
main_frame = Frame(base_window,
                   width = ancho_ventana,
                   height = alto_ventana - 80)
main_frame.grid(row = 1,column = 0)
```

* Añadimos los 2 label que muestra qué debemos poner en cada control. Les pondremos el mismo tipo de letra

```python
font_etiquetas = ('Poppins 15 bold')

label_tipo_peticion = Label(main_frame,
                            text = 'Peticion',
                            font = font_etiquetas,
                            justify = LEFT)
label_tipo_peticion.place(x = 5,y = 0)

label_lugar = Label(main_frame,
                    text = 'Lugar',
                    font = font_etiquetas,
                    justify = RIGHT)

label_lugar.place(x = 160,y = 0)  
```

* Creamos un control de tipo **Combo** que es un selector. También definimos la lista de los posibles valores entre los que se pueden elegir y el ancho en número de caracteres.

```python
tipo_peticion = ['actual','pronostico']
combo_tipo_peticion=ttk.Combobox(main_frame,
                                 values = tipo_peticion,
                                 width = 9,
                                 font = font_texto)
combo_tipo_peticion.place(x = 10,y = 32)
```
* Ahora vamos a incluir un control Entry (texto editable) para que se introduzca el lugar. Establecemos el ancho en número de caracteres y la fuente a usar.

```python

from tkinter import ttk

entry_lugar = ttk.Entry(main_frame,
                        width = 11,
                        font = font_texto)
entry_lugar.place(x = 170, y = 32)
```

* Añadimos ahora un control Text (texto largo) para que se muestre el resultado. Establecemos  el número de caracteres de ancho y las filas, también el tipo de letra.

```python
text_resultado = Text(main_frame,
                      width = 22,
                      height = 6,
                      wrap = WORD,
                      font = font_texto,
                      state = 'normal')

text_resultado.insert(INSERT,"Aqui se mostrara el resultado de haber hecho la peticion")
text_resultado.place(x = 5, y = 72)
```

* Por último vamos a añadir un **Button** (botón) del que definiremos su texto, color de fondo y del texto así como la función a la que se llamará al pulsarlo:

```python
button_get = Button(main_frame,
                    text = 'get',
                    bg = color_boton,
                    fg = color_blanco,
                    font = font_etiquetas,
                    command = get_weather)

button_get.place(x = 5, y = 255)
```

* Esta función se ejecutará al pulsar el botón y se encargará de leer los valores de los controles. Si no se ha seleccionado un tipo de petición y un lugar se mostrará una ventana de error, usando el método **showerror** de **tkinter.messagebox**. Si los controles tiene valores se hará la petición y se mostrará el resultado en el control text_resultado:

```python

from tkinter.messagebox import showerror

def get_weather():
    try:
        tipo = combo_tipo_peticion.get()
        lugar = entry_lugar.get()
        
        if tipo == '' or lugar == '':
            raise Exception
        
        # debemos descargar la consulta real
        resultado = 'hecho '+tipo+' en ' + lugar
        
        print(resultado)
        
        text_resultado.delete(1.0,"end")
        text_resultado.insert(1.0, resultado)
       

    except Exception as e:
        print('Error',e)        
        showerror(title='Error', message='Debes seleccionar un tipo e introducir un lugar')

```

Este es el resultado completo:


[Código](./codigo/tk-aweather.py)

```python
from tkinter import *
from tkinter import ttk
from tkinter.messagebox import showerror

v= 0.3

base_window = Tk()

ancho_ventana = 350
alto_ventana = 400
base_window.geometry(f'{ancho_ventana}x{alto_ventana}+1200+200')
# base_window.geometry('350x400+3400+20') # 2 monitores
base_window.title('Weather forecast')  # asignamos un título

base_window.resizable(height=False,width=False)  # definimos su comportamiento ante cambios de tamaño

# Colores https://www.w3schools.com/colors/colors_picker.asp
color_blanco = '#FFFFFF'
color_negro = '#000000'
color_titulo = '#081F4D'
color_boton = '#0083FF'


def get_weather():
    try:
        tipo = combo_tipo_peticion.get()
        lugar = entry_lugar.get()
        
        if tipo == '' or lugar == '':
            raise Exception
        
        resultado = 'hecho '+tipo+' en ' + lugar
        
        print(resultado)
        
        text_resultado.delete(1.0,"end")
        text_resultado.insert(1.0, resultado)
       

    except Exception as e:
        print('Error',e)        
        showerror(title='Error', message='Debes seleccionar un tipo e introducir un lugar')

        
# Creamos los controles

# frame superior
top_frame_titulo = Frame(base_window,
                         bg = color_titulo,
                         width = ancho_ventana,
                         height = 80)
top_frame_titulo.grid(row=0,column=0)

# etiqueta del título
label_titulo = Label(top_frame_titulo,
                      text = 'Prevision del tiempo',
                      bg = color_titulo,
                      fg = color_blanco,
                      pady = 30, padx = 10,
                      justify = CENTER,
                      font = ('Poppins 18 bold'))
 
label_titulo.grid(row=0,column=0) 

# frame inferior
main_frame = Frame(base_window,
                   width = ancho_ventana,
                   height = alto_ventana - 80)
main_frame.grid(row = 1,column = 0)

font_etiquetas = ('Poppins 15 bold')

# etiquetas de los controles
label_tipo_peticion = Label(main_frame,
                            text = 'Peticion',
                            font = font_etiquetas,
                            justify = LEFT)
label_tipo_peticion.place(x = 5,y = 0)

label_lugar = Label(main_frame,
                    text = 'Lugar',
                    font = font_etiquetas,
                    justify = RIGHT)

label_lugar.place(x = 160,y = 0)        

font_texto = ('Poppins 15')

tipo_peticion = ['actual','pronostico']
combo_tipo_peticion=ttk.Combobox(main_frame,
                                 values = tipo_peticion,
                                 width = 9,
                                 font = font_texto)
combo_tipo_peticion.place(x = 10,y = 32)
                    
entry_lugar = ttk.Entry(main_frame,
                        width = 11,
                        font = font_texto)
entry_lugar.place(x = 170, y = 32)


text_resultado = Text(main_frame,
                      width = 22,
                      height = 6,
                      wrap = WORD,
                      font = font_texto,
                      state = 'normal')

text_resultado.insert(INSERT,"Aqui se mostrara el resultado de haber hecho la peticion")
text_resultado.place(x = 5, y = 72)

button_get = Button(main_frame,
                    text = 'get',
                    bg = color_boton,
                    fg = color_blanco,
                    font = font_etiquetas,
                    command = get_weather)

button_get.place(x = 5, y = 255)
                    
base_window.mainloop() # hasta que la cerremos
```

### Agenda

Vamos a hacer ahora una sencilla aplicación en la que mostramos los datos de nuestra agenda.

* Importamos los controles Tk y Ttk

```python
from tkinter import *
from tkinter import ttk
```

* Importamos el módulo agenda para acceder a su funcionalidad y cargamos los datos

```python
import agenda

# cargamos los contactos que están guardados
agenda.cargar_agenda()

```

* Revisamos los contactos y sus datos para ver los campos que tenemos con datos y los guardamos en __lista_campos__ para crear las columnas de nuestra tabla

```python
lista_campos = ['nombre'] # nos aseguramos de que al menos esté el campo "nombre"


# campos disponibles
for contacto in agenda.lista_contactos:
    for clave,valor in contacto.items():
        if clave not in lista_campos:
            lista_campos.append(clave)
```

* Creamos la ventana:

```python
window_base = Tk()
window_base.title(f'Agenda {agenda.v}')
```

* Vamos a seleccionar un tema para el aspecto de la aplicación. Podemos saber los temas disponibles con __style.theme_names()__

```python
style = ttk.Style()
style.theme_use('clam')
```

* Creamos una tabla de datos con **ttk.Treeview** pasándole la lista de campos:

```python
tree = ttk.Treeview(window_base, 
                    column = lista_campos,
                    show = 'headings')
```

* Creamos las columnas asociadas a los campos y sus características de alineamiento, creando sus cabeceras. Lo haremos recorriendo la lista de campos

```python
contador = 1
for campo in lista_campos:
    columna_id = "#"+str(contador)
    if campo == 'nombre':
        tree.column(columna_id, anchor = CENTER)
    elif campo == 'edad':
        tree.column(columna_id, anchor = E )
    else:
        tree.column(columna_id, anchor = W )

    tree.heading(columna_id, text=campo)
    contador += 1

```

* Insertamos las filas de datos leyendo los contactos y creando una lista con los valores de cada fila. Si un campo está vacío añadimos un texto '-' para indicarlo. Insertamos en el árbol los valores al final de la tabla

```python
for contacto in agenda.lista_contactos:
    valores = []
    for campo in lista_campos:
        if campo in contacto.keys():
            valores.append(contacto[campo])
        else:
            valores.append('-')
    print(valores)
    tree.insert("",END,values=valores) # insertamos al final de la tabla

```

* Ajustamos la forma de la tabla de datos con tree.pack

```python
tree.pack()
```

* Vamos a crear un menú con 2 elementos: "Acerca de" y "Salir". Primero creamos una barra de menú que enlazamos a la ventana principal.

```python
menubar = Menu(window_base)
window_base.config(menu=menubar)
```

* Creamos un menú del que colgaremos los elementos y que llamaremos "Archivo"

```python
file_menu = Menu(menubar)
menubar.add_cascade(label = 'Archivo',
                    menu = file_menu)
```

* Creamos los 2 elementos de menú cada uno con un comando, para salir usamos el método __windows_base.destroy__ que cierra la ventana y para "Acerca de..." creamos una función que mostrará una sencilla ventana.

```python
# menu salir
file_menu.add_command(label = 'Salir',
                      command = window_base.destroy)

# menu about
file_menu.add_command(label = 'Acerca de ...',
                      command = about_window)
```

* Creamos la función que nos va a mostrar la ventana de "Acerca de...":

```python
def about_window():
    window_about = Tk()
    window_about.title('Acerca de...')
    label_about = Label(window_about,
                      text = f'Agenda{agenda.v}',
                      justify = CENTER,
                      font = ('Poppins 18 bold'))
    label_about.grid(row=0,column=0)
```

Se deja como ejercicio crear un interface para poder insertar nuevos contactos:

* Crearemos un campo de texto por cada campo del contacto
* Añadimos un botón. Al pulsarlo leemos los campos y creamos un contacto nuevo con los valores que no sean vacíos.

## Referencias

[Tutorial Tkinter](https://realpython.com/python-gui-tkinter/)

[Documentación TKinter](https://anzeljg.github.io/rin2/book2/2405/docs/tkinter/index.html)
